
{% block content %}
{% load staticfiles %}

<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'js/jquery.min.js' %}"></script>
<link href="{% static 'css/handsontable.full.css' %}" rel="stylesheet">
<script src="{% static 'js/handsontable.full.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
<link href="{% static 'css/handsontable.full.min.css' %}" rel="stylesheet">
<script src="{% static 'js/handsontable.full.min.js' %}"></script>

<!--AJAX request and response-->
<script type="text/javascript" src="{% static 'js/jquery.ajax.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/jquery.ajax-plugin.min.js' %}"></script>

<form action="/create_post/" method="POST" id="post-form">
{% csrf_token %}
    <div id="handson">
    </div>
    <div align="center"><input value="Post" type="submit" class="save btn btn-default"/>Save</div>
</form>

<script type="text/javascript">

    var
      nestedObjects = [
        {% for prod in prods %}
          {slc: '{{prod.nsn}}', name: '{{prod.generic_name}}', select: false},
        {% endfor %}
      ],
      container4 = document.getElementById('handson'),
      hot4;

      hot4 = new Handsontable(container4, {
      data: nestedObjects,
      colHeaders: [
        'SLC NUMBER',
        'PRODUCT NAME',
        'QUANTITY ACCEPTED',
        'QUANTITY REJECTED',
        'QUANTITY BALANCE',
        'SELECT',
      ],
      columns: [
        {data: 'slc'},
        {data: 'name'},
        {data: 'qty_a'},
        {data: 'qty_r'},
        {data: 'qty_b'},
        {data: 'select', type: 'checkbox'}
      ],
    });

$('#post-form').on('submit', function(event){
  event.preventDefault();
  console.log("form submitted!");
  create_post();
});

function create_post(){
  console.log("Create post is working!");
  $.ajax({
    url: "{% url 'create_post' %}",
    type: "POST",
    data: {
      handson : JSON.stringify(hot4.getData())
    },
    success: function (json){
      console.log(json);
      console.log("success");
    },
    error: function (xhr, errmsg, err){
      console.log("error");
      console.log(hot4.getData());
    }
  });

};

</script>

<script type="text/javascript">
    ajaxPost("{% url 'my_view' %}", {"data": JSON.stringify(hot4.getData())},
      function(content){
            alert(content);
        });
</script>

<a href="/handson/" class="btn btn-primary" data-ajax="true" data-success="processResponse">Show Alert</a>

{% endblock %}
